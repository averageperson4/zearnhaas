<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Proxy Loader - billybobgames</title>
<style>
  body {
    background: #2b2b2b;
    color: #e0e0e0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  #loading-container {
    width: 90%;
    max-width: 480px;
    text-align: center;
  }
  #loading-bar {
    height: 6px;
    width: 0%;
    background: #4da6ff;
    border-radius: 4px;
    transition: width 0.2s ease;
    margin-top: 10px;
  }
  #loading-text {
    margin-top: 12px;
    font-size: 1.1rem;
  }
  #fallback-message {
    margin-top: 20px;
    font-size: 0.9rem;
    color: #ccc;
    display: none;
  }
  #manual-select {
    margin-top: 15px;
    color: #4da6ff;
    cursor: pointer;
    text-decoration: underline;
    display: none;
    user-select: none;
  }
  #manual-select:hover {
    color: #a3c9ff;
  }
</style>
</head>
<body>

<div id="loading-container">
  <div id="loading-text">Finding the best proxy for you...</div>
  <div id="loading-bar"></div>
  <div id="fallback-message">
    All servers are currently sleeping/down.<br />
    Please wait as we try to wake them.<br />
    If this takes more than a minute, please send feedback <a href="https://docs.google.com/forms/d/1xE5A3uYYN02mKgWIO0--GJwjwLFjWhrm-p0ewwLbSYk/" target="_blank" style="color: #4da6ff; text-decoration: underline;">here</a>.
  </div>
  <div id="manual-select">Choose a server manually</div>
</div>

<script>
  // List your proxy servers here (must support CORS or use no-cors fetch)
  const servers = [
    'https://proxy1.example.com/',
    'https://proxy2.example.com/',
    'https://proxy3.example.com/',
  ];

  let connectedServer = null;
  let serverStatus = {};
  const retryInterval = 30000; // 30 seconds

  const loadingText = document.getElementById('loading-text');
  const loadingBar = document.getElementById('loading-bar');
  const fallbackMessage = document.getElementById('fallback-message');
  const manualSelectLink = document.getElementById('manual-select');

  function resetUI() {
    connectedServer = null;
    serverStatus = {};
    fallbackMessage.style.display = 'none';
    manualSelectLink.style.display = 'none';
    loadingBar.style.width = '0%';
    loadingBar.style.height = '6px'; // normal height
    loadingText.textContent = 'Finding the best proxy for you...';
  }

  function pingServer(url) {
    return fetch(url, {mode: 'no-cors'})
      .then(() => true)
      .catch(() => false);
  }

  async function findWorkingServer() {
    resetUI();

    for (let i = 0; i < servers.length; i++) {
      loadingText.textContent = `Checking server ${i + 1} of ${servers.length}...`;
      loadingBar.style.width = `${(i / servers.length) * 100}%`;

      let isUp = await pingServer(servers[i]);
      serverStatus[servers[i]] = isUp;

      if (isUp) {
        connectedServer = servers[i];
        loadingText.textContent = `Connected to server ${i + 1}`;
        loadingBar.style.width = '100%';
        manualSelectLink.style.display = 'inline-block';
        startBackgroundPings();
        // TODO: add logic here to load iframe or redirect to the working proxy
        return;
      } else {
        await new Promise(r => setTimeout(r, 150)); // faster delay
      }
    }

    // Fallback if no servers connected
    loadingText.textContent = 'All servers are currently sleeping/down. Please wait as we try to wake them. If this takes more than a minute, please send feedback.';
    fallbackMessage.style.display = 'block';
    manualSelectLink.style.display = 'inline-block';

    loadingBar.style.width = '50%';
    loadingBar.style.height = '3px';

    setTimeout(findWorkingServer, retryInterval);
  }

  function startBackgroundPings() {
    setInterval(() => {
      servers.forEach(server => {
        pingServer(server).then(isUp => {
          serverStatus[server] = isUp;
        });
      });
    }, retryInterval);
  }

  manualSelectLink.addEventListener('click', () => {
    alert('Manual server selection menu coming soon!');
    // You can implement a dropdown or popup with server list here.
  });

  window.addEventListener('load', findWorkingServer);
</script>

</body>
</html>
